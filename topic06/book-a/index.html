 <!DOCTYPE html>
 <html>
   <head>
     <meta charset="utf-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
   
     <title> MyRent-06 </title>
   
     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <link rel="stylesheet" href="http://cdn.jsdelivr.net/semantic-ui/0.19.3/css/semantic.min.css">
     <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script> 
     <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script src="http://cdn.jsdelivr.net/semantic-ui/0.19.3/javascript/semantic.min.js"></script>
 
     <link href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/solarized_light.min.css" rel="stylesheet" /> 
     <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>
     <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

    <style>


body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size: 14px
}

code
{
	font-family: "Monaco";
	font-size: 110%;
}

h1 
{
  font-style:italic;
  font-size:120%;
  border-bottom: thin solid black;
}
h2 
{
  font-size:110%;
  border-bottom: thin solid black;
}
h3 
{
  font-size:100%;
  border-bottom: thin solid black;
}

#footertext 
{
  font-size:70%
}


#title 
{
  font-size:120%;
  color: black;
  text-align: right;
  background-color : white;
}

img 
{
   padding:1px;
  /* border:1px solid black;*/
   margin-top: 10px;
   margin-bottom: 10px;
}

header img
{
	 padding:1px;
   border:0px solid black;
}

header h1
{
  font-style:normal;
  font-size:120%;
  border-bottom: 0px;
}

header h2
{
  font-style:normal;
  font-size:100%;
  border-bottom: 0px;
}

header h3
{
  font-style:normal;
  font-size:90%;
  border-bottom: 0px;
}

    </style>

  </head>
  <body>
  <nav class="ui fixed top pointing borderless inverted menu">
    <header class="header item"> <a href="../index.html">6: Fragments, Maps & ViewPager</a></header>
    <div class="right tab-menu menu">
          <a class="item" data-tab="MyRent-06"> MyRent-06 </a>
          <a class="item" data-tab="01"> 01 </a>
          <a class="item" data-tab="02"> 02 </a>
          <a class="item" data-tab="03"> 03 </a>
          <a class="item" data-tab="04"> 04 </a>
          <a class="item" data-tab="05"> 05 </a>
          <a class="item" data-tab="06"> 06 </a>
          <a class="item" data-tab="07"> 07 </a>
          <a class="item" data-tab="Archives"> Archives </a>
    </div>
  </nav>

  <br>

	  <section data-tab="MyRent-06" class="ui tab stacked moodle-book segment">
	     <h1>Fragments &amp; Maps</h1>
<p>Modern Android Activities tend to be composed of one or more Fragments - as opposed to consisting of a single layouts. This introduces a slightly more complicated creation process. However, using fragments opens up other opportunities we will explore in later labs.</p>
	  </section>
	  <section data-tab="01" class="ui tab stacked moodle-book segment">
	     <h1>Resources (Layout)</h1>
<p>Rename activity_residence.xml to fragment_myrent.xml.</p>
<p>Replace its content with the following:</p>
<p>Filename: res/layout/fragment_myrent.xml</p>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot; &gt;

  &lt;!-- LOCATION --&gt;
  &lt;TextView
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text=&quot;@string/location&quot;
    style=&quot;?android:listSeparatorTextViewStyle&quot;/&gt; 
  &lt;LinearLayout
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:orientation=&quot;horizontal&quot; 
    android:baselineAligned=&quot;false&quot;&gt;

    &lt;!-- Geolocation (GPS Coords) --&gt;      
    &lt;LinearLayout
      android:layout_width=&quot;0dp&quot;
      android:layout_height=&quot;match_parent&quot;
      android:layout_weight=&quot;60&quot;
      android:orientation=&quot;vertical&quot; &gt;

      &lt;TextView
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginLeft=&quot;10dp&quot;
        android:text=&quot;@string/geolocation_label&quot; /&gt;

      &lt;EditText   
        android:id=&quot;@+id/geolocation&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:hint=&quot;@string/geolocation_hint&quot; &gt;
       &lt;requestFocus /&gt;   
      &lt;/EditText&gt; 
    &lt;/LinearLayout&gt; 
    &lt;!-- Show Map Button --&gt;          
    &lt;LinearLayout
      android:layout_width=&quot;0dp&quot;
      android:layout_height=&quot;match_parent&quot;
      android:layout_weight=&quot;40&quot;
      android:orientation=&quot;vertical&quot; &gt;

    &lt;Button android:id=&quot;@+id/show_map&quot;
      android:layout_width=&quot;wrap_content&quot;
      android:layout_height=&quot;wrap_content&quot;
      android:text=&quot;@string/show_map&quot;
      android:layout_marginTop=&quot;16dp&quot;
      android:layout_marginLeft=&quot;16dp&quot;
      android:layout_marginRight=&quot;16dp&quot;/&gt;  
  &lt;/LinearLayout&gt;
  &lt;/LinearLayout&gt;

  &lt;!-- STATUS --&gt;   
  &lt;TextView
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text=&quot;@string/status&quot;
    style=&quot;?android:listSeparatorTextViewStyle&quot;/&gt;

  &lt;Button android:id=&quot;@+id/registration_date&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_marginLeft=&quot;16dp&quot;
    android:layout_marginRight=&quot;16dp&quot;/&gt;

  &lt;CheckBox
    android:id=&quot;@+id/isrented&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:enabled=&quot;true&quot;
    android:focusable=&quot;false&quot;
    android:gravity=&quot;center&quot;
    android:text=&quot;@string/rented_checkbox_text&quot;/&gt;
  &lt;Button
    android:id=&quot;@+id/tenant&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_marginLeft=&quot;16dp&quot;
    android:layout_marginRight=&quot;16dp&quot;
    android:text=&quot;@string/landlord_label&quot; /&gt;  

  &lt;Button android:id=&quot;@+id/residence_reportButton&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_marginLeft=&quot;16dp&quot;
    android:layout_marginRight=&quot;16dp&quot;
    android:text=&quot;@string/residence_report_text&quot;/&gt; 
&lt;/LinearLayout&gt;
</code></pre>

<p>Add res/layout/fragment_container.xml</p>
<pre><code>&lt;FrameLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
  android:id=&quot;@+id/fragmentContainer&quot;
  android:layout_width=&quot;match_parent&quot;
  android:layout_height=&quot;match_parent&quot;
  /&gt;
</code></pre>

<p>Three missing strings will flag errors.</p>
<ul>
<li>Add these resources to res/values/strings in a later step.</li>
<li>For the moment, tolerate the errors.</li>
</ul>
<p>The major change here is to the layout in which we have added a map button as shown in the following Figure 1:</p>
<p><img alt="Figure 1: Layout before and following refactoring" src="img/04.png"></p>
	  </section>
	  <section data-tab="02" class="ui tab stacked moodle-book segment">
	     <h1>Resources (Strings)</h1>
<p>In an earlier step when refactoring fragment_residence.xml the presence of following new string resources was indicated:</p>
<ul>
<li>show_map</li>
<li>landlord_label</li>
<li>residence_report_text</li>
<li>geolocation_label</li>
<li>residence_title</li>
</ul>
<p>Additionally, the existing string resources</p>
<ul>
<li>residence_report </li>
<li>settings</li>
</ul>
<p>are required. Add these to the strings file:</p>
<pre><code>  &lt;string name=&quot;residence_report&quot;&gt;%1$s! The residence was registered on %2$s. %3$s, and %4$s&lt;/string&gt; 
  &lt;string name=&quot;settings&quot;&gt;Settings&lt;/string&gt;

</code></pre>

<p>Here is the refactored strings file containing these resources.</p>
<p>File: res/values/strings.xml</p>
<pre><code>
&lt;resources&gt;

  &lt;string name=&quot;app_name&quot;&gt;MyRent&lt;/string&gt;
  &lt;string name=&quot;geolocation_hint&quot;&gt;52.253456,-7.187162&lt;/string&gt;
  &lt;string name=&quot;geolocation_label&quot;&gt;Geolocation&lt;/string&gt;
  &lt;string name=&quot;status&quot;&gt;Status&lt;/string&gt;
  &lt;string name=&quot;rented_checkbox_text&quot;&gt;Rented?&lt;/string&gt;
  &lt;string name=&quot;location&quot;&gt;Location&lt;/string&gt;
  &lt;string name=&quot;new_residence&quot;&gt;New Residence&lt;/string&gt;
  &lt;string name=&quot;residences_title&quot;&gt;Residences&lt;/string&gt;
  &lt;string name=&quot;settings&quot;&gt;Settings&lt;/string&gt;
  &lt;string name=&quot;delete_residence&quot;&gt;Delete Residence&lt;/string&gt;   
  &lt;string name=&quot;landlord&quot;&gt;Prospective Tenant&lt;/string&gt;
  &lt;string name=&quot;residence_report&quot;&gt;%1$s!
    The residence was registered on %2$s. %3$s, and %4$s
  &lt;/string&gt;    
  &lt;string name=&quot;residence_report_rented&quot;&gt;The residence is already let.&lt;/string&gt;
  &lt;string name=&quot;residence_report_not_rented&quot;&gt;The residence is still available.&lt;/string&gt;
  &lt;string name=&quot;residence_report_nobody_interested&quot;&gt;there is no other prospective tentant at this time.&lt;/string&gt;
  &lt;string name=&quot;residence_report_prospective_tenant&quot;&gt;the prospective tenant is %s.&lt;/string&gt;
  &lt;string name=&quot;residence_report_subject&quot;&gt;Status Report on Residence Availability&lt;/string&gt;
  &lt;string name=&quot;send_report&quot;&gt;Send residence report via&lt;/string&gt;   

  &lt;string name=&quot;show_map&quot;&gt;Show Map&lt;/string&gt;
  &lt;string name=&quot;landlord_label&quot;&gt;Prospective Tenant&lt;/string&gt;
  &lt;string name=&quot;residence_report_text&quot;&gt;Send Residence Information&lt;/string&gt; 

&lt;/resources&gt;
</code></pre>

<p>The application should now be free of errors.</p>
	  </section>
	  <section data-tab="03" class="ui tab stacked moodle-book segment">
	     <h1>Resources (Menu)</h1>
<p>Delete res/menu/residencelist.xml</p>
<ul>
<li>Ignore, for now, the errors that this deletion will trigger in ResidenceListActivity.</li>
</ul>
<p>Add the following files:</p>
<p>res/menu/residence_list_item_context.xml</p>
<pre><code>&lt;menu
  xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
    &lt;item android:id=&quot;@+id/menu_item_delete_residence&quot;
    android:icon=&quot;@android:drawable/ic_menu_delete&quot;
    android:title=&quot;@string/delete_residence&quot; /&gt;
&lt;/menu&gt;
</code></pre>

<p>res/menu/my_rent.xml</p>
<pre><code>&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    tools:context=&quot;org.wit.myrent.MyRentActivity&quot; &gt;

    &lt;item
        android:id=&quot;@+id/action_settings&quot;
        android:orderInCategory=&quot;100&quot;
        android:showAsAction=&quot;never&quot;
        android:title=&quot;@string/settings&quot;/&gt;

&lt;/menu&gt;
</code></pre>

<p>res/menu/fragment_residence_list.xml</p>
<pre><code>    &lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;
        &lt;item
            android:id=&quot;@+id/menu_item_new_residence&quot;
            android:icon=&quot;@android:drawable/ic_menu_add&quot;
            android:showAsAction=&quot;ifRoom|withText&quot;
            android:title=&quot;@string/new_residence&quot;/&gt;
    &lt;/menu&gt;

</code></pre>
	  </section>
	  <section data-tab="04" class="ui tab stacked moodle-book segment">
	     <h1>MyRent Activity &amp; Fragment</h1>
<p>Delete org.wit.myrent.activities/ResidenceActivity.java</p>
<p>Add the followng files to activities package:</p>
<p>MyRentActivity.java</p>
<pre><code>package org.wit.myrent.activities;

import java.util.UUID;

import org.wit.myrent.R;

import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.support.v4.app.FragmentActivity;
import android.support.v4.app.FragmentManager;

public class MyRentActivity extends FragmentActivity
{
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.fragment_container);

    FragmentManager manager = getSupportFragmentManager();
    Fragment fragment = manager.findFragmentById(R.id.fragmentContainer);
    if (fragment == null)
    {
      fragment = createFragment();
      manager.beginTransaction().add(R.id.fragmentContainer, fragment).commit();
    }
  }

  protected Fragment createFragment()
  {
    UUID resId = (UUID)getIntent().getSerializableExtra(MyRentFragment.EXTRA_RESIDENCE_ID);
    return MyRentFragment.newInstance(resId);
  }
}
</code></pre>

<p>MyRentFragment.java</p>
<pre><code>package org.wit.myrent.activities;

import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;
import java.util.UUID;

import org.wit.android.helpers.ContactHelper;
import org.wit.android.helpers.IntentHelper;
import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;
import org.wit.myrent.models.Residence;
import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.provider.ContactsContract;
import android.support.v4.app.Fragment;
import android.text.Editable;
import android.text.TextWatcher;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.View.OnClickListener;
import android.app.DatePickerDialog;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.CompoundButton;
import android.widget.CompoundButton.OnCheckedChangeListener;
import android.widget.DatePicker;
import android.widget.EditText;
import static org.wit.android.helpers.IntentHelper.sendEmail;
import static org.wit.android.helpers.IntentHelper.navigateUp;


public class MyRentFragment extends Fragment implements TextWatcher, 
                                                        OnCheckedChangeListener, 
                                                        OnClickListener, 
                                                        DatePickerDialog.OnDateSetListener
{
  public static   final String  EXTRA_RESIDENCE_ID = &quot;myrent.RESIDENCE_ID&quot;;

  private static  final int     REQUEST_DATE = 0;
  private static  final int     REQUEST_CONTACT = 1;

  private EditText geolocation;
  private CheckBox rented;
  private Button   dateButton;
  private Button   tenantButton;
  private Button   reportButton;
  private Button   mapButton;

  private Residence   residence;
  private Portfolio   portfolio;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setHasOptionsMenu(true);
    UUID resId = (UUID)getArguments().getSerializable(EXTRA_RESIDENCE_ID);

    MyRentApp app = (MyRentApp) getActivity().getApplication();
    portfolio = app.portfolio; 
    residence = portfolio.getResidence(resId);  

  }

  @Override
  public View onCreateView(LayoutInflater inflater, ViewGroup parent, Bundle savedInstanceState)
  {
    View v = inflater.inflate(R.layout.fragment_myrent, parent, false);

    getActivity().getActionBar().setDisplayHomeAsUpEnabled(true);
    addListeners(v);
    updateControls(residence);

    return v;
  } 

  public static MyRentFragment newInstance(UUID resId)
  {
    Bundle args = new Bundle();
    args.putSerializable(EXTRA_RESIDENCE_ID, resId);
    MyRentFragment fragment = new MyRentFragment();
    fragment.setArguments(args);
    return fragment;
  }

  private void addListeners(View v)
  {
    geolocation = (EditText) v.findViewById(R.id.geolocation);
    dateButton  = (Button)   v.findViewById(R.id.registration_date);
    rented      = (CheckBox) v.findViewById(R.id.isrented);
    tenantButton = (Button)  v.findViewById(R.id.tenant);
    reportButton = (Button)  v.findViewById(R.id.residence_reportButton);
    mapButton    = (Button)  v.findViewById(R.id.show_map);

    geolocation.addTextChangedListener(this);
    dateButton  .setOnClickListener(this);
    rented      .setOnCheckedChangeListener(this);
    tenantButton.setOnClickListener(this);
    reportButton.setOnClickListener(this);
    mapButton   .setOnClickListener(this);
  }

  public void updateControls(Residence residence)
  {
    geolocation.setText(residence.geolocation);   
    rented.setChecked(residence.rented);
    dateButton.setText(residence.getDateString());
  }

  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
    case android.R.id.home: navigateUp(getActivity());
                            return true;
    default:                return super.onOptionsItemSelected(item);
    }
  }

  @Override
  public void onPause()
  {
    super.onPause();
    portfolio.saveResidences();
  }

  @Override
  public void onActivityResult(int requestCode, int resultCode, Intent data)
  {
    if (resultCode != Activity.RESULT_OK)
    {
      return;
    }
    else
      if (requestCode == REQUEST_CONTACT)
      {
        String name = ContactHelper.getContact(getActivity(), data);
        residence.tenant = name;
        tenantButton.setText(name);
      }   
  }

  @Override
  public void beforeTextChanged(CharSequence s, int start, int count, int after)
  { }

  @Override
  public void onTextChanged(CharSequence s, int start, int before, int count)
  {}

  @Override
  public void afterTextChanged(Editable c)
  {
    Log.i(this.getClass().getSimpleName(), &quot;geolocation &quot; + c.toString());
    residence.geolocation = c.toString();    
  }

  @Override
  public void onCheckedChanged(CompoundButton buttonView, boolean isChecked)
  {
    residence.rented = isChecked;   
  }

  @Override
  public void onClick(View v)
  {
    switch (v.getId())
    {
      case R.id.registration_date      : Calendar c = Calendar.getInstance();
                                         DatePickerDialog dpd = new DatePickerDialog (getActivity(), this, c.get(Calendar.YEAR), c.get(Calendar.MONTH), c.get(Calendar.DAY_OF_MONTH));
                                         dpd.show();
                                         break; 
      case R.id.tenant                 : //selectContact(getActivity(), REQUEST_CONTACT);
                                         Intent i = new Intent(Intent.ACTION_PICK, ContactsContract.Contacts.CONTENT_URI);
                                         startActivityForResult(i, REQUEST_CONTACT);
                                         if (residence.tenant != null)
                                         {
                                           tenantButton.setText(&quot;Tenant: &quot;+residence.tenant);
                                         }   
                                         break;
     case R.id.residence_reportButton  : sendEmail(getActivity(), &quot;&quot;, getString(R.string.residence_report_subject), residence.getResidenceReport(getActivity()));                           
                                         break;                      
      case R.id.show_map               : IntentHelper.openPreferredLocationInMap(getActivity(), residence.geolocation);
                                         break;   

    }
  }

  @Override
  public void onDateSet(DatePicker view, int year, int monthOfYear, int dayOfMonth)
  {  
    Date date = new GregorianCalendar(year, monthOfYear, dayOfMonth).getTime();
    residence.date = date;
    dateButton.setText(residence.getDateString());
  }
}
</code></pre>
	  </section>
	  <section data-tab="05" class="ui tab stacked moodle-book segment">
	     <h1>List Activity &amp; Fragment</h1>
<p>Replace content of ResidenceListActivity with:</p>
<pre><code>package org.wit.myrent.activities;

import org.wit.myrent.R;

import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.support.v4.app.FragmentActivity;
import android.support.v4.app.FragmentManager;


public class ResidenceListActivity extends FragmentActivity
{

  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.fragment_container);

    FragmentManager manager = getSupportFragmentManager();
    Fragment fragment = manager.findFragmentById(R.id.fragmentContainer);
    if (fragment == null)
    {
      fragment = new ResidenceListFragment();
      manager.beginTransaction().add(R.id.fragmentContainer, fragment).commit();
    }
  }
}
</code></pre>

<p>Add ResidenceListFragment.java</p>
<pre><code>package org.wit.myrent.activities;

import java.util.ArrayList;

import org.wit.android.helpers.IntentHelper;
import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;
import org.wit.myrent.models.Residence;

import android.widget.ListView;
import android.view.ActionMode;
import android.view.ContextMenu;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.widget.ArrayAdapter;
import android.view.ViewGroup;
import android.view.ContextMenu.ContextMenuInfo;
import android.widget.AdapterView;
import android.widget.TextView;
import android.widget.CheckBox;
import android.widget.AbsListView.MultiChoiceModeListener;
import android.widget.AdapterView.AdapterContextMenuInfo;
import android.annotation.TargetApi;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.support.v4.app.ListFragment;
import android.widget.AdapterView.OnItemClickListener;

public class ResidenceListFragment extends ListFragment implements OnItemClickListener, MultiChoiceModeListener
{ 
  private ArrayList&lt;Residence&gt; residences;
  private ListView         listView;
  private Portfolio        portfolio;
  private ResidenceAdapter adapter;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setHasOptionsMenu(true); 
    getActivity().setTitle(R.string.residences_title);

    MyRentApp app = (MyRentApp) getActivity().getApplication();
    portfolio = app.portfolio; 
    residences = portfolio.residences;

    adapter = new ResidenceAdapter(getActivity(), residences);
    setListAdapter(adapter);
  }

  @Override
  public View onCreateView(LayoutInflater inflater, ViewGroup parent, Bundle savedInstanceState)
  {
    View v = super.onCreateView(inflater, parent, savedInstanceState);

    listView = (ListView)v.findViewById(android.R.id.list);
    listView.setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);
    listView.setMultiChoiceModeListener(this);

    return v;
  }

  @Override
  public void onListItemClick(ListView l, View v, int position, long id)
  {
    Residence res = ((ResidenceAdapter)getListAdapter()).getItem(position);
    Intent i = new Intent(getActivity(), MyRentActivity.class);
    i.putExtra(MyRentFragment.EXTRA_RESIDENCE_ID, res.id);
    startActivity(i);
  }

  @Override
  public void onResume()
  {
    super.onResume();
    ((ResidenceAdapter)getListAdapter()).notifyDataSetChanged();
  }

  @Override
  public void onCreateOptionsMenu(Menu menu, MenuInflater inflater)
  {
    super.onCreateOptionsMenu(menu, inflater);
    inflater.inflate(R.menu.fragment_residence_list, menu);
  } 

  @TargetApi(11)
  @Override
  public boolean onOptionsItemSelected(MenuItem item)
  {
    switch (item.getItemId())
    {
    case R.id.menu_item_new_residence:
      Residence residence = new Residence();
      portfolio.addResidence(residence);

      Intent i = new Intent(getActivity(), MyRentActivity.class);
      i.putExtra(MyRentFragment.EXTRA_RESIDENCE_ID, residence.id);
      startActivityForResult(i, 0);
      return true;

    default:
      return super.onOptionsItemSelected(item);
    }
  }

  @Override
  public void onCreateContextMenu(ContextMenu menu, View v, ContextMenuInfo menuInfo)
  {
    getActivity().getMenuInflater().inflate(R.menu.residence_list_item_context, menu);
  }

  @Override
  public boolean onContextItemSelected(MenuItem item)
  {
    AdapterContextMenuInfo info = (AdapterContextMenuInfo) item.getMenuInfo();
    int position = info.position;
    ResidenceAdapter adapter = (ResidenceAdapter) getListAdapter();
    Residence res = adapter.getItem(position);
    switch (item.getItemId())
    {
      case R.id.menu_item_delete_residence:
        portfolio.deleteResidence(res);
        adapter.notifyDataSetChanged();
        return true;
    }
    return super.onContextItemSelected(item);
  }  

  @Override
  public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id)
  {
    Residence residence = adapter.getItem(position);
    IntentHelper.startActivityWithData(getActivity(), MyRentActivity.class, &quot;RESIDENCE_ID&quot;, residence.id);
  }

  public boolean onActionItemClicked(ActionMode mode, MenuItem item)
  {
    switch (item.getItemId())
    {
      case R.id.menu_item_delete_residence: for (int i = adapter.getCount() - 1; i &gt;= 0; i--)
                              {
                                if (listView.isItemChecked(i))
                                {
                                  portfolio.deleteResidence(adapter.getItem(i));
                                }
                              }
                              mode.finish();
                              adapter.notifyDataSetChanged();
                              return true;

    default:                  return false;
    }
  }
  public boolean onPrepareActionMode(ActionMode mode, Menu menu)
  {
    return false;
  }
  public boolean onCreateActionMode(ActionMode mode, Menu menu)
  {
    MenuInflater inflater = mode.getMenuInflater();
    inflater.inflate(R.menu.residencelistcontext, menu);
    return true;
  } 

  public void onDestroyActionMode(ActionMode mode)
  {} 

  public void onItemCheckedStateChanged(ActionMode mode, int position, long id, boolean checked)
  {}

  class ResidenceAdapter extends ArrayAdapter&lt;Residence&gt;
  {
    private Context context;

    public ResidenceAdapter(Context context, ArrayList&lt;Residence&gt; residences)
    {
      super(context, 0, residences);
      this.context = context;
    }

    @Override
    public View getView(int position, View convertView, ViewGroup parent)
    {
      LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
      if (convertView == null)
      {
        convertView = inflater.inflate(R.layout.list_item_residence, null);
      }
      Residence res = getItem(position);

      TextView geolocation = (TextView) convertView.findViewById(R.id.residence_list_item_geolocation);
      geolocation.setText(res.geolocation);

      TextView dateTextView = (TextView) convertView.findViewById(R.id.residence_list_item_dateTextView);
      dateTextView.setText(res.getDateString());

      CheckBox rentedCheckBox = (CheckBox) convertView.findViewById(R.id.residence_list_item_isrented);
      rentedCheckBox.setChecked(res.rented);

      return convertView;
    }
  }
}

</code></pre>

<p>Add a method to portfolio to delete a specific residence:</p>
<p>In file: org.wit.myrent.models.Portfolio.java:</p>
<pre><code>  public void deleteResidence(Residence c)
  {
    residences.remove(c);
  }
</code></pre>

<p>The application should now contain just a single error.</p>
<ul>
<li>This is caused by a missing method: IntentHelper.openPreferredLocationInMap.</li>
<li>We shall add this missing method shortly.</li>
</ul>
	  </section>
	  <section data-tab="06" class="ui tab stacked moodle-book segment">
	     <h1>Map</h1>
<p>Add the following method to IntentHelper:</p>
<pre><code>  public static void openPreferredLocationInMap(Activity parent, String location)
  {
    Uri geoLocation = Uri.parse(&quot;geo:0,0?&quot;).buildUpon().appendQueryParameter(&quot;q&quot;, location).build();

    Intent intent = new Intent(Intent.ACTION_VIEW);
    intent.setData(geoLocation);

    if (intent.resolveActivity(parent.getPackageManager()) != null)
    {
      parent.startActivity(intent);
    }
    else
    {
      LogHelpers.info(parent, &quot;Couldn't call &quot; + location + &quot;, no receiving apps installed!&quot;);
    }
  } 
</code></pre>
	  </section>
	  <section data-tab="07" class="ui tab stacked moodle-book segment">
	     <h1>Manifest</h1>
<p>Run MyRent and attempt to create a new residence.</p>
<ul>
<li>The application will crash, the reason being that it is unable to locate the new activity MyRentActivity.</li>
</ul>
<p>In AndroidManifest.xml:</p>
<ul>
<li>delete the ResidenceyActivity node
<img alt="" src="img/02.png"></li>
<li>add a MyRentActivity node</li>
</ul>
<pre><code>    &lt;activity 
        android:name=&quot;.activities.MyRentActivity&quot;
        android:label=&quot;@string/app_name&quot;&gt;

        &lt;meta-data  
          android:name=&quot;android.support.PARENT_ACTIVITY&quot;
          android:value=&quot;.activities.ResidenceListActivity&quot;/&gt;
    &lt;/activity&gt;
</code></pre>

<p>Build and install the app on the device:</p>
<ul>
<li>Create a new residence</li>
<li>Exercise the functionality including checking that pressing the Map button results in a map being launched with a marker positioned at the geolocation entered in residence detailed view.</li>
</ul>
<p><img alt="Figure 1: Test map functionality" src="img/03.png"></p>
	  </section>
	  <section data-tab="Archives" class="ui tab stacked moodle-book segment">
	     <h1>Archives</h1>
<p>This is a version of MyRent complete to the end if this lab:</p>
<ul>
<li><a href="archives/MyRentV06.zip">MyRentV06</a></li>
</ul>
	  </section>
<script>

function addCaptions() {
  var images = $(".moodle-book img");
  jQuery.each(images, function(i)  {
    if((images[i].alt).length > 0) 
    {
      var div_img = $(document.createElement("div")).addClass("ui segment");
      $(images[i]).wrap(div_img);
      var div_label = $(document.createElement("div")).addClass("ui ribbon teal top attached label");
      div_label.append(images[i].alt);
      $(div_label).insertBefore(images[i]);
    }
  });
};

// Need to check if we have already been loaded
seen = 0;

$(document).ready(function()
{ 
  if (seen == 0)
  { 
    // not loaded before - so do the restyling once (need to moodle book print)
    $(".moodle-book img").addClass ("ui image");
    $(".moodle-book pre").addClass ("ui segment");
    addCaptions();
    seen = 1;
  }


})</script>
  <br>  
  <div class="ui fixed bottom borderless menu">'
    <div class="ui small item"> 
    <p id="footertext">
    Prepared by  Eamonn de Leastar (edeleastar@tssg.wit.ie) & John Fitzgerald (johnjfitzgerald@outlook.com). Except where otherwise noted, this content is licensed under a  
     <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/" 
       target="_blank">Creative Commons Attribution-NonCommercial 4.0 License
     </a>
     </p>
    </div>
  </div>   
    
  <script>
    $(document).ready(function()
    {  
      $('.tab-menu.menu .item').tab();
    });
  </script>   
  </body>
 </html>