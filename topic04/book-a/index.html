 <!DOCTYPE html>
 <html>
   <head>
     <meta charset="utf-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
   
     <title> MyRent-02 </title>
   
     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <link rel="stylesheet" href="http://beta.semantic-ui.com/dist/semantic.min.css">
     <script src="http://beta.semantic-ui.com/javascript/library/jquery.min.js"></script>
     <script src="http://beta.semantic-ui.com/dist/semantic.min.js"></script>

     <link href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/solarized_light.min.css" rel="stylesheet" /> 
     <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>
     <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

    <style>


body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

#container
{
  margin :10px
}

code
{
	font-family: "Monaco";
	font-size: 110%;
}

h1 
{
  font-style:italic;
  font-size:120%;
  border-bottom: thin solid black;
}
h2 
{
  font-size:110%;
  border-bottom: thin solid black;
}
h3 
{
  font-size:100%;
  border-bottom: thin solid black;
}

#footertext 
{
  font-size:70%
}

#title 
{
  font-size:120%;
  color: black;
  text-align: right;
  background-color : white;
}

img 
{
   padding:1px;
   border:1px solid black;
   margin-top: 10px;
   margin-bottom: 10px;
}

header img
{
	 padding:1px;
   border:0px solid black;
}

header h1
{
  font-style:normal;
  font-size:120%;
  border-bottom: 0px;
}

header h2
{
  font-style:normal;
  font-size:100%;
  border-bottom: 0px;
}

header h3
{
  font-style:normal;
  font-size:90%;
  border-bottom: 0px;
}

.cover
{
    width: 290px;
    height: 290px;
    border:1px solid lightgray;
}
.image-thumbnail
{
    height: 100%;
    background-size: cover;
    -moz-background-size: cover;
    -webkit-background-size: cover;
    background-position: center;
}



    </style>

  </head>
  <body>
  <nav class="ui fixed top pointing borderless inverted menu">
    <header class="header item"> <a href="../index.html">4: ListView, Action Bar & Dialogs</a></header>
    <div class="right tab-menu menu">
          <a class="item" data-tab="MyRent-02"> MyRent-02 </a>
          <a class="item" data-tab="01"> 01 </a>
          <a class="item" data-tab="02"> 02 </a>
          <a class="item" data-tab="03"> 03 </a>
          <a class="item" data-tab="04"> 04 </a>
          <a class="item" data-tab="05"> 05 </a>
          <a class="item" data-tab="06"> 06 </a>
          <a class="item" data-tab="07"> 07 </a>
          <a class="item" data-tab="08"> 08 </a>
          <a class="item" data-tab="09"> 09 </a>
          <a class="item" data-tab="10"> 10 </a>
          <a class="item" data-tab="Archives"> Archives </a>
    </div>
  </nav>

  <br>

	  <section data-tab="MyRent-02" class="ui tab stacked moodle-book segment">
	     <h1>ListView</h1>
<p>Our current version of MyRent (V01) only permits a single Residence to be entered. In this lab we seek to manage a list of residences. To do this we need to extend the model in include a new class - 'Portfolio' - to manage all our residences. We will also need a new Activity - ResidenceListActivity - to display the full portfolio of residences.</p>
	  </section>
	  <section data-tab="01" class="ui tab stacked moodle-book segment">
	     <h1>Objectives</h1>
<p>This lab will significantly extend the MyRent app to include a new ListView where all residences can be inspected:</p>
<p><img alt="" src="img/01.png"></p>
<p>Clicking on any residence will take the user to the appropriate residence detail view:</p>
<p><img alt="" src="img/02.png"></p>
<p>The Project will take on a different shape, which some interesting new classes and approaches:</p>
<p><img alt="" src="img/03.png"></p>
	  </section>
	  <section data-tab="02" class="ui tab stacked moodle-book segment">
	     <h1>Model</h1>
<p>When introducing new features, it is often useful to start with the model. </p>
<ul>
<li>We would like to incorporate a collection of Residence instances as opposed to just a single Residence as previously. </li>
<li>We will create a new model class called <em>Portfolio</em> for this purpose. Create this class now in the models package. </li>
</ul>
<h2>Portfolio</h2>
<pre><code>package org.wit.myrent.models;


import java.util.ArrayList;
import java.util.UUID;

import android.util.Log;

public class Portfolio
{
  public  ArrayList&lt;Residence&gt;  residences;

  public Portfolio()
  {
    residences = new ArrayList&lt;Residence&gt;();
    this.generateTestData();
  }

  public void addResidence(Residence residence)
  {
    residences.add(residence);
  }

  public Residence getResidence(UUID id)
  {
    Log.i(this.getClass().getSimpleName(), &quot;UUID parameter id: &quot;+ id);

    for (Residence res : residences)
    {
      if(id.equals(res.id))
      {
        return res; 
      }
    }
    return null;
  }

  private void generateTestData()
  {
    for(int i = 0; i &lt; 100; i += 1)
    {
      Residence r = new Residence();
      r.geolocation = (52.253456 + i) % 90 +  &quot;, &quot; + (-7.187162 - i) % 180 + &quot;&quot;;
      if(i%2 == 0)
      {
        r.rented = true;
      }
      else
      {
        r.rented = false;
      }
      residences.add(r);
    }
  }
}
</code></pre>

<p>Notice that, for test purposes, we are populating residences list with a random set of Residence objects.</p>
	  </section>
	  <section data-tab="03" class="ui tab stacked moodle-book segment">
	     <h1>Application</h1>
<p>To manage the list of residences, we use an <code>Application</code> object. </p>
<ul>
<li>This is an object created when the application is launched, and we are guaranteed that there will only ever be one of them. </li>
<li>This is extremely useful - and we would use it to create the single Portfolio object, which in turn contains the list of residences our app is managing.</li>
</ul>
<p>Create a package called 'org.wit.myrent.app' and introduce the following class:</p>
<pre><code>package org.wit.myrent.app;

import org.wit.myrent.models.Portfolio;
import android.app.Application;

public class MyRentApp extends Application
{
  public Portfolio portfolio;

  @Override
  public void onCreate()
  {
    super.onCreate();
    portfolio = new Portfolio();
  }
}
</code></pre>

<p>We will not create  MyRentApp object, it will be created for us by the operating system (OS). </p>
<ul>
<li>However, we do need to let the OS know that we have introduced an application object which is to be created. </li>
<li>This is done in the manifest file AndroidManifest.XML.</li>
</ul>
<p>Adjust it now as follows:</p>
<pre><code>  &lt;application
    android:name=&quot;.app.MyRentApp&quot;
    android:allowBackup=&quot;true&quot;
    android:icon=&quot;@drawable/ic_launcher&quot;
    android:label=&quot;@string/app_name&quot;
    android:theme=&quot;@style/AppTheme&quot; &gt;
</code></pre>

<p>Notice the new entry here:</p>
<pre><code>    android:name=&quot;.app.MyRentApp&quot;
</code></pre>

<p>Run the app now, and place a breakpoint in the onCreate method. If the app stops at this point, then you have successfully introduced an application object.
<img alt="" src="img/08.png"></p>
	  </section>
	  <section data-tab="04" class="ui tab stacked moodle-book segment">
	     <h1>Layouts</h1>
<p>We need two new layout resource in order to build the list view:</p>
<ul>
<li>activity_residencelist.xml</li>
<li>list_item_residence.xml</li>
</ul>
<p>activity_residencelist represents full activity, containing a single ListView widget:</p>
<p><img alt="" src="img/04.png"></p>
<p>list_item_residence will represent an individual list item:</p>
<p><img alt="" src="img/05.png"></p>
<p>The screen shots above should give you enough clues to create these resources. They will be added to the res/lagout folder in the project:</p>
<p><img alt="" src="img/06.png"></p>
<p>Here are the full xml files for reference purposes:</p>
<h2>activity_residencelist.xml</h2>
<pre><code>&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;&gt;

    &lt;ListView
        android:id=&quot;@+id/residenceList&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot; &gt;
    &lt;/ListView&gt;

&lt;/RelativeLayout&gt;
</code></pre>

<h2>list_item_residence.xml</h2>
<pre><code>&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;&gt;

    &lt;CheckBox
        android:id=&quot;@+id/residence_list_item_isrented&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:gravity=&quot;center&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:enabled=&quot;false&quot;
        android:focusable=&quot;false&quot;
        android:padding=&quot;4dp&quot;
         /&gt;

    &lt;TextView
        android:id=&quot;@+id/residence_list_item_geolocation&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_toLeftOf=&quot;@id/residence_list_item_isrented&quot;
        android:textStyle=&quot;bold&quot;
        android:paddingLeft=&quot;4dp&quot;
        android:paddingRight=&quot;4dp&quot;
        /&gt;

    &lt;TextView
        android:id=&quot;@+id/residence_list_item_dateTextView&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_below=&quot;@id/residence_list_item_geolocation&quot;
        android:layout_toLeftOf=&quot;@id/residence_list_item_isrented&quot;
        android:paddingLeft=&quot;4dp&quot;
        android:paddingRight=&quot;4dp&quot;
        android:paddingTop=&quot;4dp&quot;/&gt;

&lt;/RelativeLayout&gt;
</code></pre>
	  </section>
	  <section data-tab="05" class="ui tab stacked moodle-book segment">
	     <h2>ResidenceListActivity</h2>
<p>We can now start to introduce the ResidenceListActivity class</p>
<h2>ResidenceListActivity</h2>
<pre><code>package org.wit.myrent.activities;

import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;
import android.widget.ListView;
import android.app.Activity;
import android.os.Bundle;

public class ResidenceListActivity extends Activity
{
  private ListView listView;
  private Portfolio portfolio;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setTitle(R.string.app_name);
    setContentView(R.layout.activity_residencelist);

    listView = (ListView) findViewById(R.id.residenceList);

    MyRentApp app = (MyRentApp) getApplication();
    portfolio = app.portfolio;
  }
}
</code></pre>

<p>This version does not do much. However, if it is to be started at all, we need to change the AndroidManifest.xml again, indicating that this is the 'Launch' activity for the app:</p>
<pre><code>&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
  package=&quot;org.wit.myrent&quot;
  android:versionCode=&quot;1&quot;
  android:versionName=&quot;1.0&quot; &gt;

  &lt;uses-sdk
    android:minSdkVersion=&quot;16&quot;
    android:targetSdkVersion=&quot;19&quot; /&gt;

  &lt;application
    android:name=&quot;.app.MyRentApp&quot;
    android:allowBackup=&quot;true&quot;
    android:icon=&quot;@drawable/ic_launcher&quot;
    android:label=&quot;@string/app_name&quot;
    android:theme=&quot;@style/AppTheme&quot; &gt;

    &lt;activity
      android:name=&quot;.activities.ResidenceListActivity&quot;
      android:label=&quot;@string/app_name&quot; &gt;
      &lt;intent-filter&gt;
        &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
        &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
      &lt;/intent-filter&gt;
    &lt;/activity&gt;    

    &lt;activity
      android:name=&quot;.activities.ResidenceActivity&quot;
      android:label=&quot;@string/app_name&quot; &gt;  
    &lt;/activity&gt; 

  &lt;/application&gt;

&lt;/manifest&gt;
</code></pre>

<p>Inspect the above closely, and note how our app now contains 2 activities, with ResidenceListActivity being the 'MAIN' one.</p>
<p>Run the app now and verify that it runs. Drop a breakpoint in the onCreate method above, and verify that the portfolio is properly initialised. Also notice that the listView is initialised.
<img alt="Figure 1: ResidenceListActivity.onCreate" src="img/09.png"></p>
	  </section>
	  <section data-tab="06" class="ui tab stacked moodle-book segment">
	     <h2>Adapters</h2>
<p>In order to update the list with the residence object contained in the portfolio, we need an Adapter. </p>
<ul>
<li>An Adapter is a special class we can append to the end of the existing ResidenceListActivity class (make sure it is outside the closing brace of ResidenceListActivity).</li>
</ul>
<h2>ResidenceAdapter:</h2>
<pre><code>class ResidenceAdapter extends ArrayAdapter&lt;Residence&gt;
{
  private Context context;

  public ResidenceAdapter(Context context, ArrayList&lt;Residence&gt; residences)
  {
    super(context, 0, residences);
    this.context = context;
  }

  @Override
  public View getView(int position, View convertView, ViewGroup parent)
  {
    LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
    if (convertView == null)
    {
      convertView = inflater.inflate(R.layout.list_item_residence, null);
    }
    Residence res = getItem(position);

    TextView geolocation = (TextView) convertView.findViewById(R.id.residence_list_item_geolocation);
    geolocation.setText(res.geolocation);

    TextView dateTextView = (TextView) convertView.findViewById(R.id.residence_list_item_dateTextView);
    dateTextView.setText(res.getDateString());

    CheckBox rentedCheckBox = (CheckBox) convertView.findViewById(R.id.residence_list_item_isrented);
    rentedCheckBox.setChecked(res.rented);

    return convertView;
  }
}
</code></pre>

<p>Introducing <em>ResidenceAdapter</em> requires the following additional import statements:</p>
<pre><code>import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.CheckBox;
import android.widget.TextView;
import java.util.ArrayList;
import org.wit.myrent.models.Residence;

</code></pre>

<p>This class, ResidenceAdapter, acts as a mediator between our model and the view elements. Use Eclipse autocorrect to import the appropriate library classes.</p>
<p>In order to incorporate it into ResidenceListActivity, first introduce a new field for it:</p>
<pre><code>  private ResidenceAdapter adapter;
</code></pre>

<p>and the, in order to trigger it, we need the following code at the very end of OnCreate in ResidenceListActivity:</p>
<pre><code>    adapter = new ResidenceAdapter(this, portfolio.residences);
    listView.setAdapter(adapter);
</code></pre>

<p>Run the app now - it should display the list of random residences:</p>
<p><img alt="" src="img/01.png"></p>
<p>This is the complete ResidenceListActivity class for references purposes:</p>
<pre><code>package org.wit.myrent.activities;

import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;

import android.widget.ListView;
import android.app.Activity;
import android.os.Bundle;
import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.CheckBox;
import android.widget.TextView;
import java.util.ArrayList;
import org.wit.myrent.models.Residence;

public class ResidenceListActivity extends Activity
{
  private ListView listView;
  private Portfolio portfolio;
  private ResidenceAdapter adapter;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setTitle(R.string.app_name);
    setContentView(R.layout.activity_residencelist);

    listView = (ListView) findViewById(R.id.residenceList);

    MyRentApp app = (MyRentApp) getApplication();
    portfolio = app.portfolio;

    adapter = new ResidenceAdapter(this, portfolio.residences);
    listView.setAdapter(adapter);   
  }
}

class ResidenceAdapter extends ArrayAdapter&lt;Residence&gt;
{
  private Context context;

  public ResidenceAdapter(Context context, ArrayList&lt;Residence&gt; residences)
  {
    super(context, 0, residences);
    this.context = context;
  }

  @Override
  public View getView(int position, View convertView, ViewGroup parent)
  {
    LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
    if (convertView == null)
    {
      convertView = inflater.inflate(R.layout.list_item_residence, null);
    }
    Residence res = getItem(position);

    TextView geolocation = (TextView) convertView.findViewById(R.id.residence_list_item_geolocation);
    geolocation.setText(res.geolocation);

    TextView dateTextView = (TextView) convertView.findViewById(R.id.residence_list_item_dateTextView);
    dateTextView.setText(res.getDateString());

    CheckBox rentedCheckBox = (CheckBox) convertView.findViewById(R.id.residence_list_item_isrented);
    rentedCheckBox.setChecked(res.rented);

    return convertView;
  }
}
</code></pre>
	  </section>
	  <section data-tab="07" class="ui tab stacked moodle-book segment">
	     <h2>Intents</h2>
<p>Currently the application just displays the list, and we do not have any way of navigating form the list to individual residences. To bind them we will first have to listen for clicks on the list in ResidenceListActivity. This requires that we implement OnItemClickListener:</p>
<pre><code>public class ResidenceListActivity extends Activity implements OnItemClickListener
</code></pre>

<p>You can try to let Eclipse help you here with the appropriate imports and default implementations:</p>
<p><img alt="" src="img/07.png"></p>
<p>The above should generate this new listener method:</p>
<pre><code>  @Override
  public void onItemClick(AdapterView&lt;?&gt; arg0, View arg1, int arg2, long arg3)
  {
    // TODO Auto-generated method stub

  }
</code></pre>

<p>Replace the above generated method with the following version (we have changed the argument names to more meaningful ones):</p>
<pre><code>  @Override
  public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id)
  {
    Intent intent = new Intent(this, ResidenceActivity.class);
    startActivity(intent);
  }
</code></pre>

<p>Import the <em>Intent</em> class:</p>
<pre><code>import android.content.Intent;
</code></pre>

<p>If the user clicks on an item, we should start our ResidenceActivity - the one we deisgned earlier. Try this now.</p>
<p>It doesnt work? This is because we didnt install the ResidenceListActivity object as a listener. Add this line to OnCreate:</p>
<pre><code>    listView.setOnItemClickListener(this);
</code></pre>

<p>You should now be able to navigate from any list item to the detail view as shown in Figure 1.</p>
<ul>
<li>Note however that, for the moment, the detailed view rendered is always the first in the list irrespective of which list item is clicked.</li>
</ul>
<p><img alt="Figure 1: Click any list item to navigate to a detail view" src="img/10.png"></p>
<p>This is the complete ResidenceListActivity at this stage:</p>
<pre><code>package org.wit.myrent.activities;

import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;

import android.widget.ListView;
import android.app.Activity;
import android.os.Bundle;
import android.content.Context;
import android.content.Intent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ArrayAdapter;
import android.widget.CheckBox;
import android.widget.TextView;

import java.util.ArrayList;

import org.wit.myrent.models.Residence;

public class ResidenceListActivity extends Activity implements OnItemClickListener
{
  private ListView listView;
  private Portfolio portfolio;
  private ResidenceAdapter adapter;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setTitle(R.string.app_name);
    setContentView(R.layout.activity_residencelist);

    listView = (ListView) findViewById(R.id.residenceList);

    MyRentApp app = (MyRentApp) getApplication();
    portfolio = app.portfolio;

    adapter = new ResidenceAdapter(this, portfolio.residences);
    listView.setAdapter(adapter);  
    listView.setOnItemClickListener(this);
  }

  @Override
  public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id)
  {
    Intent intent = new Intent(this, ResidenceActivity.class);
    startActivity(intent);
  }
}

class ResidenceAdapter extends ArrayAdapter&lt;Residence&gt;
{
  private Context context;

  public ResidenceAdapter(Context context, ArrayList&lt;Residence&gt; residences)
  {
    super(context, 0, residences);
    this.context = context;
  }

  @Override
  public View getView(int position, View convertView, ViewGroup parent)
  {
    LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
    if (convertView == null)
    {
      convertView = inflater.inflate(R.layout.list_item_residence, null);
    }
    Residence res = getItem(position);

    TextView geolocation = (TextView) convertView.findViewById(R.id.residence_list_item_geolocation);
    geolocation.setText(res.geolocation);

    TextView dateTextView = (TextView) convertView.findViewById(R.id.residence_list_item_dateTextView);
    dateTextView.setText(res.getDateString());

    CheckBox rentedCheckBox = (CheckBox) convertView.findViewById(R.id.residence_list_item_isrented);
    rentedCheckBox.setChecked(res.rented);

    return convertView;
  }
}
</code></pre>
	  </section>
	  <section data-tab="08" class="ui tab stacked moodle-book segment">
	     <h2>Activity Arguments</h2>
<p>When ResidenceActivity is started, it doesnt seem to display anything useful - and certainly not the items in the list we started it from. </p>
<ul>
<li>We need to be able to pass information to ResidenceActivity, so it can display the correct Residence model object - that which we have selected in the list of residences. </li>
<li>This will involve making changes in both ResidenceListActivity and ResidenceActivity.</li>
</ul>
<h2>ResidenceListActivity</h2>
<pre><code>  @Override
  public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id)
  {
    Residence residence = adapter.getItem(position);
    Intent intent = new Intent(this, ResidenceActivity.class);
    intent.putExtra(&quot;RESIDENCE_ID&quot;, residence.id);
    startActivity(intent);
  }

</code></pre>

<p>In the above. notice that:</p>
<ul>
<li>The argument <em>residence.id</em> in <em>putExtra</em> represents the residence the user clicked on (by position). <ul>
<li>We obtain this from the portfolio and then pass it to the intent as an <strong>extra</strong> data item.</li>
</ul>
</li>
</ul>
<h2>ResidenceActivity</h2>
<p>First introduce a new field:</p>
<pre><code>  private Portfolio portfolio; 
</code></pre>

<p>Then, at the end of onCreate, initiualise this field:</p>
<pre><code>    MyRentApp app = (MyRentApp) getApplication();
    portfolio = app.portfolio;
</code></pre>

<p>Add these imports:</p>
<pre><code>import org.wit.myrent.models.Portfolio;
import org.wit.myrent.app.MyRentApp;

</code></pre>

<p>Now we can recover the ID passed to us via the intent:</p>
<pre><code>    UUID resId = (UUID) getIntent().getExtras().getSerializable(&quot;RESIDENCE_ID&quot;);
</code></pre>

<p>and get the Residence Object from the portfolio:</p>
<pre><code>    UUID resId = (UUID) getIntent().getExtras().getSerializable(&quot;RESIDENCE_ID&quot;);
    residence = portfolio.getResidence(resId);
</code></pre>

<p>This is the complete four lines we add:</p>
<pre><code>    MyRentApp app = (MyRentApp) getApplication();
    portfolio = app.portfolio;    

    UUID resId = (UUID) getIntent().getExtras().getSerializable(&quot;RESIDENCE_ID&quot;);
    residence = portfolio.getResidence(resId);
</code></pre>

<p>Now all that remains is to send the residence data to the view widgets. We can write a special method for that:</p>
<pre><code>  public void updateControls(Residence residence)
  {
    geolocation.setText(residence.geolocation);
    rented.setChecked(residence.rented);
    dateButton.setText(residence.getDateString());
  }
</code></pre>

<p>and call this method if we are sure we found a valid reference:</p>
<pre><code>    if (residence != null)
    {
      updateControls(residence);
    }
</code></pre>

<p>Build and launch the app:</p>
<ul>
<li>We should now ne able to navigate and inspect the details of any Residence from the list as illustrated in Figure 1.</li>
</ul>
<p><img alt="Figure 1: Select and click on specific residence to reveal its detail view" src="img/11.png"></p>
<p>This is the complete new version of ResidenceActivity:</p>
<pre><code>package org.wit.myrent.activities;


import java.util.UUID;

import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;
import org.wit.myrent.models.Residence;

import android.app.Activity;
import android.os.Bundle;
import android.text.Editable;
import android.text.TextWatcher;
import android.util.Log;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.CompoundButton;
import android.widget.EditText;
import android.widget.CompoundButton.OnCheckedChangeListener;

public class ResidenceActivity extends Activity implements TextWatcher, OnCheckedChangeListener
{
  private EditText geolocation;
  private CheckBox rented;
  private Button   dateButton;

  private Residence residence;
  private Portfolio portfolio; 

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_residence);

    geolocation = (EditText) findViewById(R.id.geolocation);
    dateButton  = (Button)   findViewById(R.id.registration_date);
    rented      = (CheckBox) findViewById(R.id.isrented);

    residence = new Residence();

    geolocation.addTextChangedListener(this);
    geolocation.setText(residence.geolocation);
    dateButton .setEnabled(false);
    rented     .setChecked(residence.rented);
    rented     .setOnCheckedChangeListener(this);

    MyRentApp app = (MyRentApp) getApplication();
    portfolio = app.portfolio;

    UUID resId = (UUID) getIntent().getExtras().getSerializable(&quot;RESIDENCE_ID&quot;);
    residence = portfolio.getResidence(resId);
    if (residence != null)
    {
      updateControls(residence);
    }
  }

  public void updateControls(Residence residence)
  {
    geolocation.setText(residence.geolocation);
    rented.setChecked(residence.rented);
    dateButton.setText(residence.getDateString());
  }

  @Override
  public void onCheckedChanged(CompoundButton arg0, boolean isChecked)
  {
    Log.i(this.getClass().getSimpleName(), &quot;rented Checked&quot;);
    residence.rented = isChecked;
  }

  @Override
  public void afterTextChanged(Editable c)
  {
    Log.i(this.getClass().getSimpleName(), &quot;geolocation &quot; + c.toString());
    residence.geolocation = c.toString();
  }

  @Override
  public void beforeTextChanged(CharSequence arg0, int arg1, int arg2, int arg3)
  {
  }

  @Override
  public void onTextChanged(CharSequence arg0, int arg1, int arg2, int arg3)
  {
  }
}

</code></pre>
	  </section>
	  <section data-tab="09" class="ui tab stacked moodle-book segment">
	     <h1>onResume</h1>
<p>You might notice that any changes you make in Residence do not seem to be appearing on the list. i.e. if you check or uncheck the rented status, it remains unchanged in the list view.</p>
<p>We should fix this, as it is counter-intuitive. </p>
<p>Back in ResidenceListActivity, introduce a new method into the class (ensuring that you locate it within ResidenceListActivity and not ResidenceAdapter):</p>
<pre><code>  @Override
  public void onResume()
  {
    super.onResume();
    adapter.notifyDataSetChanged();
  }  
</code></pre>

<p>Run the app again now - and verify that changes made in the ResidenceActivity are reflected in the list. </p>
<ul>
<li>Can you explain what is happening?</li>
</ul>
<p>This is the complete version if ResidenceListActivity at this stage:</p>
<pre><code>package org.wit.myrent.activities;

import org.wit.myrent.R;
import org.wit.myrent.app.MyRentApp;
import org.wit.myrent.models.Portfolio;

import android.widget.ListView;
import android.app.Activity;
import android.os.Bundle;
import android.content.Context;
import android.content.Intent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ArrayAdapter;
import android.widget.CheckBox;
import android.widget.TextView;

import java.util.ArrayList;

import org.wit.myrent.models.Residence;

public class ResidenceListActivity extends Activity implements OnItemClickListener
{
  private ListView listView;
  private Portfolio portfolio;
  private ResidenceAdapter adapter;

  @Override
  public void onCreate(Bundle savedInstanceState)
  {
    super.onCreate(savedInstanceState);
    setTitle(R.string.app_name);
    setContentView(R.layout.activity_residencelist);

    listView = (ListView) findViewById(R.id.residenceList);

    MyRentApp app = (MyRentApp) getApplication();
    portfolio = app.portfolio;

    adapter = new ResidenceAdapter(this, portfolio.residences);
    listView.setAdapter(adapter);  
    listView.setOnItemClickListener(this);
  }

  @Override
  public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id)
  {
    Residence residence = adapter.getItem(position);
    Intent intent = new Intent(this, ResidenceActivity.class);
    intent.putExtra(&quot;RESIDENCE_ID&quot;, residence.id);
    startActivity(intent);
  }

  @Override
  public void onResume()
  {
    super.onResume();
    adapter.notifyDataSetChanged();
  }   
}

class ResidenceAdapter extends ArrayAdapter&lt;Residence&gt;
{
  private Context context;

  public ResidenceAdapter(Context context, ArrayList&lt;Residence&gt; residences)
  {
    super(context, 0, residences);
    this.context = context;
  }

  @Override
  public View getView(int position, View convertView, ViewGroup parent)
  {
    LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
    if (convertView == null)
    {
      convertView = inflater.inflate(R.layout.list_item_residence, null);
    }
    Residence res = getItem(position);

    TextView geolocation = (TextView) convertView.findViewById(R.id.residence_list_item_geolocation);
    geolocation.setText(res.geolocation);

    TextView dateTextView = (TextView) convertView.findViewById(R.id.residence_list_item_dateTextView);
    dateTextView.setText(res.getDateString());

    CheckBox rentedCheckBox = (CheckBox) convertView.findViewById(R.id.residence_list_item_isrented);
    rentedCheckBox.setChecked(res.rented);

    return convertView;
  }
}
</code></pre>
	  </section>
	  <section data-tab="10" class="ui tab stacked moodle-book segment">
	     <h2>LogHelpers</h2>
<p>Our final step will be to incorporate some helper classes, upon which we will build later. Create a new package called 'org.wit.android.helpers' - and introduce this class:</p>
<pre><code>package org.wit.android.helpers;

import android.util.Log;

public class LogHelpers
{
  public static void info(Object parent, String message)
  {
    Log.i(parent.getClass().getSimpleName(), message);
  }
}
</code></pre>

<p>This class doesnt do much - but it might make is more inclined to use logging more frequently - as the class wraps up the log call into something easier to type.</p>
<p>So, for instance, in MyRentApp, import the above as follows:</p>
<pre><code>import static org.wit.android.helpers.LogHelpers.info;
</code></pre>

<p>(the import syntax is slightly different, as we are importing a specific method)</p>
<p>Then, in onCreate we can have this:</p>
<pre><code>  @Override
  public void onCreate()
  {
    super.onCreate();
    portfolio = new Portfolio();

    info(this, &quot;RentControl app launched&quot;);
  }
</code></pre>

<p>You might consider introducing other log messages in the app now. THe advantage of logs is that you can quickly appreciate the health of various aspects of the app by looking at the logs.</p>
	  </section>
	  <section data-tab="Archives" class="ui tab stacked moodle-book segment">
	     <h1>Archives</h1>
<p>This is a version of MyRent complete to the end of this lab:</p>
<ul>
<li><a href="archives/MyRentV02.zip">MyRentV02</a></li>
</ul>
	  </section>
<script>

function addCaptions() {
  var images = $(".moodle-book img");
  jQuery.each(images, function(i)  {
    if((images[i].alt).length > 0) 
    {
      var div_img = $(document.createElement("div")).addClass("ui segment");
      $(images[i]).wrap(div_img);
      var div_label = $(document.createElement("div")).addClass("ui ribbon teal top attached label");
      div_label.append(images[i].alt);
      $(div_label).insertBefore(images[i]);
    }
  });
};

// Need to check if we have already been loaded
seen = 0;

$(document).ready(function()
{ 
  if (seen == 0)
  { 
    // not loaded before - so do the restyling once (need to moodle book print)
    $(".moodle-book img").addClass ("ui image");
    $(".moodle-book pre").addClass ("ui segment");
    addCaptions();
    seen = 1;
  }


})</script>
  <br>  
  <div class="ui fixed bottom borderless menu">'
    <div class="ui small item"> 
    <p id="footertext">
    Prepared by  Eamonn de Leastar (edeleastar@tssg.wit.ie) & John Fitzgerald (johnjfitzgerald@outlook.com). Except where otherwise noted, this content is licensed under a  
     <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/" 
       target="_blank">Creative Commons Attribution-NonCommercial 4.0 License
     </a>
     </p>
    </div>
  </div>   
    
  <script>
    $(document).ready(function()
    {  
      $('.tab-menu.menu .item').tab();
    });
  </script>   
  </body>
 </html>