 <!DOCTYPE html>
 <html>
   <head>
     <meta charset="utf-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
   
     <title> MyRent-05 </title>
   
     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <link rel="stylesheet" href="http://cdn.jsdelivr.net/semantic-ui/0.19.3/css/semantic.min.css">
     <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script> 
     <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script src="http://cdn.jsdelivr.net/semantic-ui/0.19.3/javascript/semantic.min.js"></script>
 
     <link href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/solarized_light.min.css" rel="stylesheet" /> 
     <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>
     <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

    <style>


body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size: 14px
}

code
{
	font-family: "Monaco";
	font-size: 110%;
}

h1 
{
  font-style:italic;
  font-size:120%;
  border-bottom: thin solid black;
}
h2 
{
  font-size:110%;
  border-bottom: thin solid black;
}
h3 
{
  font-size:100%;
  border-bottom: thin solid black;
}

#footertext 
{
  font-size:70%
}


#title 
{
  font-size:120%;
  color: black;
  text-align: right;
  background-color : white;
}

img 
{
   padding:1px;
  /* border:1px solid black;*/
   margin-top: 10px;
   margin-bottom: 10px;
}

header img
{
	 padding:1px;
   border:0px solid black;
}

header h1
{
  font-style:normal;
  font-size:120%;
  border-bottom: 0px;
}

header h2
{
  font-style:normal;
  font-size:100%;
  border-bottom: 0px;
}

header h3
{
  font-style:normal;
  font-size:90%;
  border-bottom: 0px;
}

    </style>

  </head>
  <body>
  <nav class="ui fixed top pointing borderless inverted menu">
    <header class="header item"> <a href="../index.html">5: File IO & Implicit Intents</a></header>
    <div class="right tab-menu menu">
          <a class="item" data-tab="MyRent-05"> MyRent-05 </a>
          <a class="item" data-tab="01"> 01 </a>
          <a class="item" data-tab="02"> 02 </a>
          <a class="item" data-tab="03"> 03 </a>
          <a class="item" data-tab="04"> 04 </a>
          <a class="item" data-tab="05"> 05 </a>
          <a class="item" data-tab="Archives"> Archives </a>
    </div>
  </nav>

  <br>

	  <section data-tab="MyRent-05" class="ui tab stacked moodle-book segment">
	     <h1>Contactlist access and Email support</h1>
	  </section>
	  <section data-tab="01" class="ui tab stacked moodle-book segment">
	     <h1>Resources</h1>
<h2>res/strings.xml</h2>
<pre><code>  &lt;string name=&quot;landlord&quot;&gt;Prospective Tenant&lt;/string&gt;
  &lt;string name=&quot;residence_report&quot;&gt;Send Residence Information&lt;/string&gt;

  &lt;string name=&quot;residence_report_rented&quot;&gt;The residence is already let.&lt;/string&gt;
  &lt;string name=&quot;residence_report_not_rented&quot;&gt;The residence is still available.&lt;/string&gt;
  &lt;string name=&quot;residence_report_nobody_interested&quot;&gt;there is no other prospective tentant at this time.&lt;/string&gt;
  &lt;string name=&quot;residence_report_prospective_tenant&quot;&gt;the prospective tenant is %s.&lt;/string&gt;
  &lt;string name=&quot;residence_report_subject&quot;&gt;Status Report on Residence Availability&lt;/string&gt;
  &lt;string name=&quot;send_report&quot;&gt;Send residence report via&lt;/string&gt;   
</code></pre>

<h2>res/layout/activity_residence.xml</h2>
<pre><code>    &lt;Button
        android:id=&quot;@+id/tenant&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginLeft=&quot;16dp&quot;
        android:layout_marginRight=&quot;16dp&quot;
        android:text=&quot;@string/landlord&quot; /&gt;  

    &lt;Button android:id=&quot;@+id/residence_reportButton&quot;
          android:layout_width=&quot;match_parent&quot;
          android:layout_height=&quot;wrap_content&quot;
          android:layout_marginLeft=&quot;16dp&quot;
          android:layout_marginRight=&quot;16dp&quot;
          android:text=&quot;@string/residence_report&quot;
        /&gt; 
</code></pre>

<p><img alt="Figure 1: Prospective Tenant &amp; Send Residence Information Buttons added" src="img/01.png"></p>
<h2>Reference Purposes:</h2>
<h2>res/strings.xml</h2>
<pre><code>&lt;resources&gt;

  &lt;string name=&quot;app_name&quot;&gt;MyRent&lt;/string&gt;
  &lt;string name=&quot;geolocation_hint&quot;&gt;52.253456,-7.187162&lt;/string&gt;
  &lt;string name=&quot;status&quot;&gt;Status&lt;/string&gt;
  &lt;string name=&quot;rented_checkbox_text&quot;&gt;Rented?&lt;/string&gt;
  &lt;string name=&quot;location&quot;&gt;Location&lt;/string&gt;
  &lt;string name=&quot;new_residence&quot;&gt;New Residence&lt;/string&gt;
  &lt;string name=&quot;settings&quot;&gt;Settings&lt;/string&gt;
  &lt;string name=&quot;delete_residence&quot;&gt;Delete Residence&lt;/string&gt;   
  &lt;string name=&quot;landlord&quot;&gt;Prospective Tenant&lt;/string&gt;
  &lt;string name=&quot;residence_report&quot;&gt;Send Residence Information&lt;/string&gt;

  &lt;string name=&quot;residence_report_rented&quot;&gt;The residence is already let.&lt;/string&gt;
  &lt;string name=&quot;residence_report_not_rented&quot;&gt;The residence is still available.&lt;/string&gt;
  &lt;string name=&quot;residence_report_nobody_interested&quot;&gt;there is no other prospective tentant at this time.&lt;/string&gt;
  &lt;string name=&quot;residence_report_prospective_tenant&quot;&gt;the prospective tenant is %s.&lt;/string&gt;
  &lt;string name=&quot;residence_report_subject&quot;&gt;Status Report on Residence Availability&lt;/string&gt;
  &lt;string name=&quot;send_report&quot;&gt;Send residence report via&lt;/string&gt;   

&lt;/resources&gt;
</code></pre>

<h2>res/layout/activity_residence.xml</h2>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot; &gt;

    &lt;!-- LOCATION --&gt;

    &lt;TextView
        style=&quot;?android:listSeparatorTextViewStyle&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:text=&quot;@string/location&quot; /&gt;

    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:baselineAligned=&quot;false&quot;
        android:orientation=&quot;horizontal&quot; &gt;

        &lt;!-- Geolocation (GPS Coords) --&gt;

        &lt;EditText
            android:id=&quot;@+id/geolocation&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:hint=&quot;@string/geolocation_hint&quot; &gt;

            &lt;requestFocus /&gt;
        &lt;/EditText&gt;
        &lt;!-- Show Map Button --&gt;

    &lt;/LinearLayout&gt;

    &lt;!-- STATUS --&gt;

    &lt;TextView
        style=&quot;?android:listSeparatorTextViewStyle&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:text=&quot;@string/status&quot; /&gt;

    &lt;Button android:id=&quot;@+id/registration_date&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginLeft=&quot;16dp&quot;
        android:layout_marginRight=&quot;16dp&quot;
        /&gt;    

    &lt;CheckBox
        android:id=&quot;@+id/isrented&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:enabled=&quot;true&quot;
        android:focusable=&quot;false&quot;
        android:gravity=&quot;center&quot;
        android:text=&quot;@string/rented_checkbox_text&quot; /&gt;

    &lt;Button
        android:id=&quot;@+id/tenant&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginLeft=&quot;16dp&quot;
        android:layout_marginRight=&quot;16dp&quot;
        android:text=&quot;@string/landlord&quot; /&gt;  

    &lt;Button android:id=&quot;@+id/residence_reportButton&quot;
          android:layout_width=&quot;match_parent&quot;
          android:layout_height=&quot;wrap_content&quot;
          android:layout_marginLeft=&quot;16dp&quot;
          android:layout_marginRight=&quot;16dp&quot;
          android:text=&quot;@string/residence_report&quot;
        /&gt; 

&lt;/LinearLayout&gt;
</code></pre>
	  </section>
	  <section data-tab="02" class="ui tab stacked moodle-book segment">
	     <h1>Helpers</h1>
<h2>ContactHelper</h2>
<pre><code>package org.wit.android.helpers;

import android.content.Context;
import android.content.Intent;
import android.database.Cursor;
import android.net.Uri;
import android.provider.ContactsContract;

public class ContactHelper
{ 
  public static String getContact(Context context, Intent data)
  {
    String contact = &quot;unable to find contact&quot;;
    Uri contactUri = data.getData();
    String[] queryFields = new String[] { ContactsContract.Contacts.DISPLAY_NAME };
    Cursor c = context.getContentResolver().query(contactUri, queryFields, null, null, null);
    if (c.getCount() == 0)
    {
      c.close();
      return contact;
    }
    c.moveToFirst();
    contact = c.getString(0);
    c.close();

    return contact;
  }
}
</code></pre>

<h2>IntentHelper</h2>
<pre><code>  public static void selectContact(Activity parent, int id)
  {
    Intent selectContactIntent = new Intent(Intent.ACTION_PICK, ContactsContract.Contacts.CONTENT_URI);
    parent.startActivityForResult(selectContactIntent, id);
  }

  public static void sendEmail(Context context, String email, String subject, String body)
  {
    Intent emailIntent = new Intent(Intent.ACTION_SENDTO, Uri.fromParts(&quot;mailto&quot;, email, null));
    emailIntent.putExtra(Intent.EXTRA_SUBJECT, subject);
    emailIntent.putExtra(Intent.EXTRA_TEXT, body);
    context.startActivity(Intent.createChooser(emailIntent, &quot;Sending Email&quot;));
  }
</code></pre>

<p>Add import statements:</p>
<pre><code>import android.provider.ContactsContract;
import android.content.Context;
import android.net.Uri;
</code></pre>
	  </section>
	  <section data-tab="03" class="ui tab stacked moodle-book segment">
	     <h1>Residence</h1>
<pre><code>import org.wit.myrent.R;
import android.content.Context;
</code></pre>

<pre><code>public String  tenant;
</code></pre>

<pre><code>  private static final String JSON_TENANT         = &quot;tenant&quot;;  
</code></pre>

<pre><code>    tenant        = json.getString(JSON_TENANT);
</code></pre>

<pre><code>    json.put(JSON_TENANT        , tenant);
</code></pre>

<pre><code>  public String getResidenceReport(Context context)
  {
    String rentedString = null;
    if (rented)
    {
      rentedString = context.getString(R.string.residence_report_rented);
    }
    else
    {
      rentedString = context.getString(R.string.residence_report_not_rented);
    }
    String dateFormat = &quot;EEE, MMM dd&quot;;
    String dateString = android.text.format.DateFormat.format(dateFormat, date).toString();
    String prospectiveTenant = tenant;
    if (tenant == null)
    {
      prospectiveTenant = context.getString(R.string.residence_report_nobody_interested);
    }
    else
    {
      prospectiveTenant = context.getString(R.string.residence_report_prospective_tenant, tenant);
    }
    String report =  &quot;Location &quot; + geolocation + &quot; Date: &quot; + dateString + &quot; &quot; + rentedString + &quot; &quot; + prospectiveTenant;
    return report;
  }
</code></pre>

<h2>References Purposes:</h2>
<pre><code>package org.wit.myrent.models;

import java.text.DateFormat;
import java.util.Date;
import java.util.UUID;

import org.json.JSONException;
import org.json.JSONObject;
import org.wit.myrent.R;

import android.content.Context;

public class Residence
{
  public UUID id;

  public String  geolocation;
  public Date    date;
  public boolean rented;
  public String  tenant;

  private static final String JSON_ID             = &quot;id&quot;            ;
  private static final String JSON_GEOLOCATION    = &quot;geolocation&quot;   ; 
  private static final String JSON_DATE           = &quot;date&quot;          ; 
  private static final String JSON_RENTED         = &quot;rented&quot;        ; 
  private static final String JSON_TENANT         = &quot;tenant&quot;        ;  

  public Residence()
  {
    this.id          = UUID.randomUUID();
    this.date        = new Date();
    this.geolocation = &quot;52.253456, -7.187162&quot;;
  }

  public Residence(JSONObject json) throws JSONException
  {
    id            = UUID.fromString(json.getString(JSON_ID));
    geolocation   = json.getString(JSON_GEOLOCATION);
    date          = new Date(json.getLong(JSON_DATE));
    rented        = json.getBoolean(JSON_RENTED);
    tenant        = json.getString(JSON_TENANT);
  }

  public JSONObject toJSON() throws JSONException
  {
    JSONObject json = new JSONObject();
    json.put(JSON_ID            , id.toString());  
    json.put(JSON_GEOLOCATION   , geolocation);
    json.put(JSON_DATE          , date.getTime());       
    json.put(JSON_RENTED        , rented);     
    json.put(JSON_TENANT        , tenant);
    return json;
  }  

  public String getDateString()
  {
    return &quot;Registered: &quot; + DateFormat.getDateTimeInstance().format(date);
  }

  public String getResidenceReport(Context context)
  {
    String rentedString = null;
    if (rented)
    {
      rentedString = context.getString(R.string.residence_report_rented);
    }
    else
    {
      rentedString = context.getString(R.string.residence_report_not_rented);
    }
    String dateFormat = &quot;EEE, MMM dd&quot;;
    String dateString = android.text.format.DateFormat.format(dateFormat, date).toString();
    String prospectiveTenant = tenant;
    if (tenant == null)
    {
      prospectiveTenant = context.getString(R.string.residence_report_nobody_interested);
    }
    else
    {
      prospectiveTenant = context.getString(R.string.residence_report_prospective_tenant, tenant);
    }
    String report =  &quot;Location &quot; + geolocation + &quot; Date: &quot; + dateString + &quot; &quot; + rentedString + &quot; &quot; + prospectiveTenant;
    return report;
  }
}
</code></pre>
	  </section>
	  <section data-tab="04" class="ui tab stacked moodle-book segment">
	     <h2>ResidenceActivity - Tenant</h2>
<pre><code>import static org.wit.android.helpers.ContactHelper.getContact;
import static org.wit.android.helpers.IntentHelper.selectContact;
import android.content.Intent;
</code></pre>

<pre><code>private static final int REQUEST_CONTACT = 1;
</code></pre>

<pre><code>private Button   tenantButton;

</code></pre>

<pre><code>tenantButton = (Button)   findViewById(R.id.tenant);
</code></pre>

<pre><code>tenantButton.setOnClickListener(this);
</code></pre>

<pre><code>  @Override
  public void onClick(View v)
  {
    switch (v.getId())
    {
      //...

      case R.id.tenant                 : selectContact(this, REQUEST_CONTACT);
                                         break;                                       
    }
  }
</code></pre>
	  </section>
	  <section data-tab="05" class="ui tab stacked moodle-book segment">
	     <h2>ResidenceActivity - Email</h2>
<pre><code>import static org.wit.android.helpers.IntentHelper.sendEmail;
import android.content.Intent;
</code></pre>

<pre><code>private Button   reportButton;
</code></pre>

<pre><code>reportButton = (Button)   findViewById(R.id.residence_reportButton);
</code></pre>

<pre><code>reportButton.setOnClickListener(this);
</code></pre>

<pre><code>  @Override
  public void onClick(View v)
  {
    switch (v.getId())
    {
      //...

      case R.id.residence_reportButton : sendEmail(this, &quot;&quot;, getString(R.string.residence_report_subject), residence.getResidenceReport(this));                           
                                         break;                                         
    }
  }
</code></pre>

<pre><code>  @Override
  public void onActivityResult(int requestCode, int resultCode, Intent data)
  {
    switch (requestCode)
    {
      case REQUEST_CONTACT    : String name = getContact(this, data);
                                residence.tenant = name;
                                tenantButton.setText(name);      
                                break;
    }
  }  
</code></pre>

<p>Test the module just added as follows:</p>
<ul>
<li>Launch the app</li>
<li>Create a new residence object by clicking on the menu (+)</li>
<li>Press the <strong>Prospective Tenant</strong> button</li>
<li>Your contact list should open</li>
<li>Choose a contact</li>
<li>The name of the chosen contact should appear as the label of the Prospective Tenant button.</li>
<li>Press the <strong>Send Residence Information</strong> button</li>
<li>An email client window should open</li>
<li>Add one of your email addresses in the <strong>To</strong> slot</li>
<li>Send the email</li>
<li>Check your email and verify the mail arrives
<img alt="Figure 1: Sample Email" src="img/02.png"></li>
</ul>
	  </section>
	  <section data-tab="Archives" class="ui tab stacked moodle-book segment">
	     <h1>Archives</h1>
<p>This is a version of MyRent complete to the end if this lab:</p>
<ul>
<li><a href="archives/MyRentV05.zip">MyRentV05</a></li>
</ul>
	  </section>
<script>

function addCaptions() {
  var images = $(".moodle-book img");
  jQuery.each(images, function(i)  {
    if((images[i].alt).length > 0) 
    {
      var div_img = $(document.createElement("div")).addClass("ui segment");
      $(images[i]).wrap(div_img);
      var div_label = $(document.createElement("div")).addClass("ui ribbon teal top attached label");
      div_label.append(images[i].alt);
      $(div_label).insertBefore(images[i]);
    }
  });
};

// Need to check if we have already been loaded
seen = 0;

$(document).ready(function()
{ 
  if (seen == 0)
  { 
    // not loaded before - so do the restyling once (need to moodle book print)
    $(".moodle-book img").addClass ("ui image");
    $(".moodle-book pre").addClass ("ui segment");
    addCaptions();
    seen = 1;
  }


})</script>
  <br>  
  <div class="ui fixed bottom borderless menu">'
    <div class="ui small item"> 
    <p id="footertext">
    Prepared by  Eamonn de Leastar (edeleastar@tssg.wit.ie) & John Fitzgerald (johnjfitzgerald@outlook.com). Except where otherwise noted, this content is licensed under a  
     <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/" 
       target="_blank">Creative Commons Attribution-NonCommercial 4.0 License
     </a>
     </p>
    </div>
  </div>   
    
  <script>
    $(document).ready(function()
    {  
      $('.tab-menu.menu .item').tab();
    });
  </script>   
  </body>
 </html>